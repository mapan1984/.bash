#!/bin/bash

## Synchronize my config of bash on windows

# Usage: up -operation [mesg]
#        need help from ~/bin/up_helper
# operation:
#           -a: add
#           -c: commit
#           -push: push
#           -pull: pull
# mesg:
#     -c mesg

# Config file needed to Synchronize
config_file="$(up_helper config)"

# Error tip
function err()
{
  echo "[$(date)]: $@" 1>&2
}

# Generate .gitignore
function genetate_gitignore()
{
  up_helper ignore > ~/.gitignore
}


# Patameter judgment and acquistion
case $# in
  1) 
    operation=$1;
    mesg="";;
  2) 
    operation=$1; 
    mesg=$2;;
  *) err 'Usage: up -operation [mesg]'; exit 1 ;;
esac

# Git Operation
case $operation in
  -a*) 
    genetate_gitignore;
    git add --all ${config_file} ;;
  -c*) git commit -m "${mesg}" ;;
  -push) git push origin master ;;
  -pull) git pull origin master ;;
  *) err 'Usage: up -operation [mesg]
                 operation must in [-add, -commit [mesg], -pull, -push]';
     exit 2 ;;
esac
